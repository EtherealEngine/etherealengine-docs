"use strict";(self.webpackChunk_etherealengine_docs=self.webpackChunk_etherealengine_docs||[]).push([[26],{3044:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>h,contentTitle:()=>c,default:()=>m,frontMatter:()=>a,metadata:()=>d,toc:()=>u});var i=s(4848),l=s(8453),o=s(5326),r=s(8423),t=s(5651);const a={},c="iR Engine on MicroK8s (Linux)",d={id:"manual/modules/infrastructure/devopsDeployment/microk8s_linux",title:"iR Engine on MicroK8s (Linux)",description:"This guide has been tested on Ubuntu, and it is intended for local deployment only.",source:"@site/docs/manual/03_modules/05_infrastructure/03_devopsDeployment/01_microk8s_linux.md",sourceDirName:"manual/03_modules/05_infrastructure/03_devopsDeployment",slug:"/manual/modules/infrastructure/devopsDeployment/microk8s_linux",permalink:"/etherealengine-docs/manual/modules/infrastructure/devopsDeployment/microk8s_linux",draft:!1,unlisted:!1,editUrl:"https://github.com/EtherealEngine/etherealengine-docs/blob/master/docs/manual/03_modules/05_infrastructure/03_devopsDeployment/01_microk8s_linux.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{},sidebar:"manual",previous:{title:"Deployment",permalink:"/etherealengine-docs/manual/modules/infrastructure/devopsDeployment/"},next:{title:"iR Engine on MicroK8s (Windows)",permalink:"/etherealengine-docs/manual/modules/infrastructure/devopsDeployment/microk8s_windows"}},h={},u=[...r.RM,...t.RM,{value:"Install kubectl, Helm and Docker",id:"install-kubectl-helm-and-docker",level:2},{value:"Download and install MicroK8s",id:"download-and-install-microk8s",level:2},{value:"Download iR Engine",id:"download-ir-engine",level:2},{value:"Start MinIO &amp; MariaDB",id:"start-minio--mariadb",level:2},{value:"Enable MicroK8s Addons",id:"enable-microk8s-addons",level:2},{value:"Add MicroK8s to Kubectl",id:"add-microk8s-to-kubectl",level:2},{value:"Add MicroK8s to Lens (Optional)",id:"add-microk8s-to-lens-optional",level:2},{value:"Enable MicroK8s access for local docker",id:"enable-microk8s-access-for-local-docker",level:2},{value:"Troubleshooting MicroK8s",id:"troubleshooting-microk8s",level:2},{value:"Update the hosts file",id:"update-the-hosts-file",level:2},{value:"Add Helm repositories",id:"add-helm-repositories",level:2},{value:"Install Agones and Redis deployments",id:"install-agones-and-redis-deployments",level:2},{value:"Install Elastic Search and Kibana (Optional)",id:"install-elastic-search-and-kibana-optional",level:2},{value:"Build MicroK8s",id:"build-microk8s",level:2},{value:"Update Helm Values File",id:"update-helm-values-file",level:2},{value:"Deploy iR Engine Helm chart",id:"deploy-ir-engine-helm-chart",level:2},{value:"Accept invalid certs",id:"accept-invalid-certs",level:2},...o.RM];function p(e){const n={a:"a",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"ir-engine-on-microk8s-linux",children:"iR Engine on MicroK8s (Linux)"}),"\n",(0,i.jsx)(n.p,{children:"This guide has been tested on Ubuntu, and it is intended for local deployment only."}),"\n",(0,i.jsx)(r.Ay,{}),"\n",(0,i.jsx)(t.Ay,{}),"\n",(0,i.jsx)(n.h2,{id:"install-kubectl-helm-and-docker",children:"Install kubectl, Helm and Docker"}),"\n",(0,i.jsxs)(n.p,{children:["Install ",(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tools/",children:"kubectl"}),", ",(0,i.jsx)(n.a,{href:"https://helm.sh/docs/intro/install/",children:"Helm"})," and ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/get-docker/",children:"Docker"})," on your device if they aren't already installed.",(0,i.jsx)(n.br,{}),"\n","You may also need to install ",(0,i.jsx)(n.a,{href:"https://docs.docker.com/compose/install/",children:"Docker Compose"})]}),"\n",(0,i.jsx)(n.h2,{id:"download-and-install-microk8s",children:"Download and install MicroK8s"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo snap install microk8s --classic --channel=1.26/stable\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Note: It is recommended to use microk8s version >=1.26 due to an issue with host storage access in version 1.25."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Another alternative is to follow the instructions for how to ",(0,i.jsx)(n.a,{href:"https://ubuntu.com/tutorials/install-a-local-kubernetes-with-microk8s#1-overview",children:"install Kubernetes with MicroK8s"})," in a local environment. This will help you learn more about how MicroK8s deployment works."]}),"\n",(0,i.jsx)(n.h2,{id:"download-ir-engine",children:"Download iR Engine"}),"\n",(0,i.jsx)(n.p,{children:"To build the iR Engine Docker image locally, and to have a pre-tested way to run various local services, you'll need to download the iR Engine repository to your device. The easiest way to do this is by running the following command in your Ubuntu terminal:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/etherealengine/etherealengine.git\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can create an ",(0,i.jsx)(n.code,{children:".env.local"})," file by duplicating ",(0,i.jsx)(n.code,{children:".env.local.default"})," if it does not already exist in the root folder of iR Engine's repository."]}),"\n",(0,i.jsx)(n.h2,{id:"start-minio--mariadb",children:"Start MinIO & MariaDB"}),"\n",(0,i.jsx)(n.p,{children:"We recommend running MinIO & MariaDB server on your local machine via Docker and outside of MicroK8s."}),"\n",(0,i.jsxs)(n.p,{children:["Running the command ",(0,i.jsx)(n.code,{children:"docker-compose up"})," from the top-level ",(0,i.jsx)(n.code,{children:"/scripts"})," directory of the iR Engine repository will also start MinIO and multiple MariaDB docker containers ",(0,i.jsx)(n.em,{children:"(as well as an optional redis server)"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Port ",(0,i.jsx)(n.strong,{children:"3306"}),": Server for local development"]}),"\n",(0,i.jsxs)(n.li,{children:["Port ",(0,i.jsx)(n.strong,{children:"3305"}),": Server for automated testing"]}),"\n",(0,i.jsxs)(n.li,{children:["Port ",(0,i.jsx)(n.strong,{children:"3304"}),": Server for minikube/microk8s testing"]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["You can start the docker container by running ",(0,i.jsx)(n.code,{children:"npm run dev-docker"})," the next time you need to start it."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Alternatively, you could run MinIO & MariaDB on their own without Docker. You'll have to configure the Helm config file to have the appropriate S3 & SQL server configuration, and possibly also change the ",(0,i.jsx)(n.code,{children:"./scripts/build_microk8s.sh"})," script."]}),"\n",(0,i.jsx)(n.h2,{id:"enable-microk8s-addons",children:"Enable MicroK8s Addons"}),"\n",(0,i.jsx)(n.p,{children:"The following command will enable the required MicroK8s addons:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo microk8s enable dashboard dns registry host-access ingress rbac hostpath-storage helm3\n"})}),"\n",(0,i.jsx)(n.h2,{id:"add-microk8s-to-kubectl",children:"Add MicroK8s to Kubectl"}),"\n",(0,i.jsxs)(n.p,{children:["First make sure there is no existing configuration for microk8s in your kubectl config.",(0,i.jsx)(n.br,{}),"\n","To do so, run the following command in your Ubuntu terminal and check if the output contains ",(0,i.jsx)(n.code,{children:"microk8s"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl config get-contexts\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can remove any existing configurations using the following commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl config delete-context microk8s\nkubectl config delete-cluster microk8s-cluster\nkubectl config delete-user microk8s-admin\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Next we will add microk8s configuration to kubectl config by running the following commands (from ",(0,i.jsx)(n.a,{href:"https://discuss.kubernetes.io/t/use-kubectl-with-microk8s/5313/6",children:"Reference"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl config set-cluster microk8s --server=https://127.0.0.1:16443/ --certificate-authority=/var/snap/microk8s/current/certs/ca.crt\nkubectl config set-credentials microk8s-admin --token=\"$(sudo microk8s kubectl config view --raw -o 'jsonpath={.users[0].user.token}')\"\nkubectl config set-context microk8s --cluster=microk8s --namespace=default --user=microk8s-admin\n"})}),"\n",(0,i.jsx)(n.p,{children:"Afterwards you can use the newly created context by executing:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl config use-context microk8s\n"})}),"\n",(0,i.jsx)(n.p,{children:"Check that microk8s is the current context with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl config get-contexts\n"})}),"\n",(0,i.jsx)(n.h2,{id:"add-microk8s-to-lens-optional",children:"Add MicroK8s to Lens (Optional)"}),"\n",(0,i.jsxs)(n.p,{children:["You should now see the MicroK8s cluster in the ",(0,i.jsx)(n.a,{href:"https://k8slens.dev/",children:"K8s Lens"})," GUI tool."]}),"\n",(0,i.jsxs)(n.p,{children:["Troubleshooting:",(0,i.jsx)(n.br,{}),"\n","If you don't see it, it means that the previous step was not performed successfully.\nYou can print the current configuration using the command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"microk8s config\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Option 1:",(0,i.jsx)(n.br,{}),"\n","If you have kubectl already installed, use ",(0,i.jsx)(n.code,{children:"sudo gedit ~/.kube/config"})," and add the output of ",(0,i.jsx)(n.code,{children:"microk8s config"})," into the file."]}),"\n",(0,i.jsxs)(n.li,{children:["Option 2:",(0,i.jsx)(n.br,{}),"\n","In ",(0,i.jsx)(n.a,{href:"https://k8slens.dev/",children:"Lens"}),", goto ",(0,i.jsx)(n.code,{children:"File"})," > ",(0,i.jsx)(n.code,{children:"Add Cluster"})," and paste the output of ",(0,i.jsx)(n.code,{children:"microk8s config"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"enable-microk8s-access-for-local-docker",children:"Enable MicroK8s access for local docker"}),"\n",(0,i.jsxs)(n.p,{children:["For MicroK8s we will use MicroK8s local ",(0,i.jsx)(n.a,{href:"https://microk8s.io/docs/registry-built-in",children:"registry"})]}),"\n",(0,i.jsxs)(n.p,{children:["Add the following lines to ",(0,i.jsx)(n.code,{children:"/etc/docker/daemon.json"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["On Linux, this is can be done by running ",(0,i.jsx)(n.code,{children:"sudo gedit /etc/docker/daemon.json"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "insecure-registries": ["localhost:32000"]  \n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Afterwards, restart docker with:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart docker\n"})}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting-microk8s",children:"Troubleshooting MicroK8s"}),"\n",(0,i.jsxs)(n.p,{children:["Its recommended to fix all MicroK8s warnings for it to work properly.",(0,i.jsx)(n.br,{}),"\n","You can check if there are any warnings by running:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo microk8s inspect\n"})}),"\n",(0,i.jsx)(n.p,{children:"These are some possible warnings and their potential fixes:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"WARNING:  This machine's hostname contains capital letters and/or underscores. This is not a valid name for a Kubernetes node, causing node registration to fail. Please change the machine's hostname or refer to the documentation for more details."}),"\n",(0,i.jsxs)(n.p,{children:["Possible Fix: ",(0,i.jsx)(n.a,{href:"https://askubuntu.com/a/87687/1558816",children:"https://askubuntu.com/a/87687/1558816"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"WARNING:  The memory cgroup is not enabled. The cluster may not be functioning properly. Please ensure cgroups are enabled"}),"\n",(0,i.jsxs)(n.p,{children:["Possible Fix: ",(0,i.jsx)(n.a,{href:"https://github.com/canonical/microk8s/issues/1691#issuecomment-1265788228",children:"https://github.com/canonical/microk8s/issues/1691#issuecomment-1265788228"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["WARNING: IPtables FORWARD policy is DROP. Consider enabling traffic forwarding with: ",(0,i.jsx)(n.code,{children:"sudo iptables -P FORWARD ACCEPT"})]}),"\n",(0,i.jsxs)(n.p,{children:["The change can be made persistent with: ",(0,i.jsx)(n.code,{children:"sudo apt-get install iptables-persistent"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"MicroK8s is not running. Use microk8s inspect for a deeper inspection."}),"\n",(0,i.jsxs)(n.p,{children:["Possible Fix: ",(0,i.jsx)(n.a,{href:"https://lightrun.com/answers/canonical-microk8s-microk8s-is-not-running-microk8sinspect-showing-no-error",children:"https://lightrun.com/answers/canonical-microk8s-microk8s-is-not-running-microk8sinspect-showing-no-error"})]}),"\n",(0,i.jsxs)(n.p,{children:["Here this error cloud be due to conflicting kubectl being installed. Use this command to remove kubectl ",(0,i.jsx)(n.code,{children:"sudo rm -rf /usr/local/bin/kubectl"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"update-the-hosts-file",children:"Update the hosts file"}),"\n",(0,i.jsxs)(n.p,{children:["You'll need to edit your ",(0,i.jsx)(n.code,{children:"hosts"})," file to redirect certain domains to your host machine IP address.",(0,i.jsx)(n.br,{}),"\n","Add or update the following line into your ",(0,i.jsx)(n.code,{children:"/etc/hosts"})," file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"127.0.0.1 local.etherealengine.org api-local.etherealengine.org instanceserver-local.etherealengine.org 00000.instanceserver-local.etherealengine.org 00001.instanceserver-local.etherealengine.org 00002.instanceserver-local.etherealengine.org 00003.instanceserver-local.etherealengine.org\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["On Linux this can be done by running ",(0,i.jsx)(n.code,{children:"sudo gedit /etc/hosts"}),(0,i.jsx)(n.br,{}),"\n","Make sure to save the file after editing. You will need administrator permissions to do so."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This will redirect several ",(0,i.jsx)(n.code,{children:"*-local.etherealengine.org"})," domains internally to the host machine. ",(0,i.jsx)(n.code,{children:"nginx"})," ingress server will now be able to redirect the traffic to the appropriate iR Engine pod."]}),"\n",(0,i.jsx)(n.h2,{id:"add-helm-repositories",children:"Add Helm repositories"}),"\n",(0,i.jsx)(n.p,{children:"You'll need to add a few Helm chart repositories. You can do so by running the following commands:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm repo add agones https://agones.dev/chart/stable\nhelm repo add redis https://charts.bitnami.com/bitnami\nhelm repo add etherealengine https://helm.etherealengine.org\n"})}),"\n",(0,i.jsx)(n.p,{children:"This will add the Helm charts for Agones, Redis and iR Engine, respectively."}),"\n",(0,i.jsx)(n.h2,{id:"install-agones-and-redis-deployments",children:"Install Agones and Redis deployments"}),"\n",(0,i.jsx)(n.p,{children:"From here on, deployments will be installed using Helm repositories."}),"\n",(0,i.jsx)(n.p,{children:"Make sure that kubectl is pointed at MicroK8s by running this command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl config current-context\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["It should say ",(0,i.jsx)(n.code,{children:"microk8s"})]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You can also run this command to get all contexts that kubectl has been configured to run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl config get-contexts\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["The current context will have a ",(0,i.jsx)(n.code,{children:"*"})," under the left-most ",(0,i.jsx)(n.code,{children:"current"})," column."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Once kubectl is pointed to MicroK8s, run these commands from the top of the iR Engine repo to install Agones and Redis:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm install -f </path/to/agones-default-values.yaml> agones agones/agones\nhelm install local-redis redis/redis\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Important:",(0,i.jsx)(n.br,{}),"\n","Make sure to change ",(0,i.jsx)(n.code,{children:"/path/to/agones-default-values.yaml"})," with the actual path of the file.",(0,i.jsx)(n.br,{}),"\n","The ",(0,i.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/agones-default-values.yaml",children:"agones-default-values.yaml"})," file can be found in the ",(0,i.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops",children:"ethereal-engine-ops"})," repository."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["After a minute or so, all of these pods should be in the ",(0,i.jsx)(n.code,{children:"Running"})," state.\nYou can run this command to list all of the pods running in MicroK8s."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -A\n"})}),"\n",(0,i.jsx)(n.h2,{id:"install-elastic-search-and-kibana-optional",children:"Install Elastic Search and Kibana (Optional)"}),"\n",(0,i.jsxs)(n.p,{children:["Install Elasticsearch by adding the ",(0,i.jsx)(n.code,{children:"elastic"})," repository with Helm:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm repo add elastic https://helm.elastic.co\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Download the ",(0,i.jsx)(n.code,{children:"values.yaml"})," file containing Elasticsearch's configuration information using ",(0,i.jsx)(n.code,{children:"curl"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -O https://raw.githubusercontent.com/elastic/helm-charts/master/elasticsearch/examples/minikube/values.yaml\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Install the Elasticsearch Helm chart with ",(0,i.jsx)(n.code,{children:"helm install"})," and pass the ",(0,i.jsx)(n.code,{children:"values.yaml"})," file that we just downloaded to the command:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm install elasticsearch elastic/elasticsearch -f ./values.yaml\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"The -f option allows specifying the yaml file with the template."}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["You can add the ",(0,i.jsx)(n.code,{children:"-n"})," option, followed by a name, to install Elasticsearch in a specific namespace:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm install elasticsearch elastic/elasticsearch -n [namespace] -f ./values.yaml\n"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Check if the cluster members are running:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pods --namespace=default -l app=elasticsearch-master -w\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"Another option is to use the helm test command to examine the cluster\u2019s health:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm test elasticsearch\n"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Install Kibana on top of Elasticsearch:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm install kibana elastic/kibana\n"})}),"\n",(0,i.jsx)(n.p,{children:"Check if all of the pods are ready:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pods\n"})}),"\n",(0,i.jsxs)(n.p,{children:["After port-forwarding has been setup, Elasticsearch and the Kibana GUI can be accessed by navigating to ",(0,i.jsx)(n.a,{href:"http://localhost:5601",children:"http://localhost:5601"})," in your browser."]}),"\n",(0,i.jsxs)(n.p,{children:["Edit the file ",(0,i.jsx)(n.code,{children:"local.microk8s.template.values.yaml"})," and update the env variable ",(0,i.jsx)(n.code,{children:"api.extraEnv.ELASTIC_HOST"})," to connect the logger with Elasticsearch:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"http://<username>:<password>@<host>:<port>\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["The file ",(0,i.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/local.microk8s.template.values.yaml",children:"local.microk8s.template.values.yaml"})," can be found in the ",(0,i.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops",children:"ethereal-engine-ops"})," repo."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"build-microk8s",children:"Build MicroK8s"}),"\n",(0,i.jsx)(n.p,{children:"Run the following command from the root of the iR Engine repository after MicroK8s is running:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"./scripts/build_microk8s.sh\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Note: If you get the error ",(0,i.jsx)(n.code,{children:'"packages/projects/projects/" does not exist'}),", run the following commands in your terminal:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"export MYSQL_HOST=localhost\nnpm run dev-docker\nnpm run dev-reinit\nnpx ts-node --swc scripts/install-projects.js\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["This ",(0,i.jsx)(n.em,{children:"build_microK8s"})," script will build an image of the entire iR Engine repository into a single Docker file."]}),"\n",(0,i.jsxs)(n.p,{children:["Vite builds the client files using some information from the MariaDB database created for MicroK8s deployments to fill in some variables, and it needs database credentials.",(0,i.jsx)(n.br,{}),"\n","The script will supply default values for all of the ",(0,i.jsx)(n.code,{children:"MYSQL_*"})," variables if they are not provided to the script, as well as ",(0,i.jsx)(n.code,{children:"VITE_CLIENT_HOST"}),", ",(0,i.jsx)(n.code,{children:"VITE_SERVER_HOST"}),", and ",(0,i.jsx)(n.code,{children:"VITE_INSTANCESERVER_HOST"}),"."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["The latter three will make your MicroK8s deployment accessible on ",(0,i.jsx)(n.code,{children:"(local/api-local/instanceserver-local).etherealengine.org"}),";\nIf you want to run it on a different domain, then you'll have to set those three environment variables to what you want them to be (and also change the ",(0,i.jsx)(n.code,{children:"hosts"})," file records you made to redirect to those subdomains."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["This process may take up to 15 minutes when run for the first time.",(0,i.jsx)(n.br,{}),"\n","Consecutive builds will take less time. The process has caching support."]}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"When built for targeting multiple services, the resulting docker file will only deploy and run the parts needed for each individual service."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Once the images are built, the script will push the result to the MicroK8s local registry.",(0,i.jsx)(n.br,{}),"\n","You can verify that the images are pushed correctly by visiting ",(0,i.jsx)(n.a,{href:"http://localhost:32000/v2/_catalog",children:"http://localhost:32000/v2/_catalog"})]}),"\n",(0,i.jsx)(n.h2,{id:"update-helm-values-file",children:"Update Helm Values File"}),"\n",(0,i.jsxs)(n.p,{children:["This will use a Helm config file titled ",(0,i.jsx)(n.code,{children:"local.values.yaml"})," to configure the deployment.",(0,i.jsx)(n.br,{}),"\n","There is a ",(0,i.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/local.microk8s.template.values.yaml",children:"template"})," for this file in ",(0,i.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops",children:"ethereal-engine-ops"})," repo."]}),"\n",(0,i.jsxs)(n.p,{children:["If you are using a local file server, as explained in one of the previous steps, you will need to update the variable ",(0,i.jsx)(n.code,{children:"api.fileServer.hostUploadFolder"})," in the ",(0,i.jsx)(n.code,{children:"local.values.yaml"})," file with a value similar to ",(0,i.jsx)(n.code,{children:"ENGINE_FULL_PATH/packages/server/upload"}),".",(0,i.jsx)(n.br,{}),"\n",(0,i.jsxs)(n.em,{children:["e.g. ",(0,i.jsx)(n.code,{children:"/home/username/etherealengine/packages/server/upload"}),"."]}),(0,i.jsx)(n.br,{}),"\n","It is mandatory that it points to the ",(0,i.jsx)(n.code,{children:"/packages/server/upload"})," folder of your iR Engine folder."]}),"\n",(0,i.jsx)(n.h2,{id:"deploy-ir-engine-helm-chart",children:"Deploy iR Engine Helm chart"}),"\n",(0,i.jsx)(n.p,{children:"Run the following command:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm install -f </path/to/local.values.yaml> -f </path/to/db-refresh-true.values.yaml> local etherealengine/etherealengine\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Important:",(0,i.jsx)(n.br,{}),"\n","Make sure to change ",(0,i.jsx)(n.code,{children:"/path/to/local.values.yaml"})," and ",(0,i.jsx)(n.code,{children:"/path/to/db-refresh-true.values.yaml"})," with the actual path of the files.",(0,i.jsx)(n.br,{}),"\n","The file ",(0,i.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/db-refresh-true.values.yaml",children:"db-refresh-true.values.yaml"})," can be found in the ",(0,i.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops",children:"ethereal-engine-ops"})," repository."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["After a minute or so, running ",(0,i.jsx)(n.code,{children:"kubectl get pods"})," should show one or more instanceservers, one or more api servers, and one client server in the Running state."]}),"\n",(0,i.jsxs)(n.p,{children:["Setting the option ",(0,i.jsx)(n.code,{children:"FORCE_DB_REFRESH=true"})," made the api servers (re)initialize the database.",(0,i.jsx)(n.br,{}),"\n","Since you don't want that to happen every time a new api pod starts, run the following command to restart the API pods and configure them to not reinit the database on boot."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"helm upgrade --reuse-values -f </path/to/db-refresh-false.values.yaml> local etherealengine/etherealengine\n"})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Important:",(0,i.jsx)(n.br,{}),"\n","Make sure to change ",(0,i.jsx)(n.code,{children:"/path/to/db-refresh-true.values.yaml"})," with the actual path of the file.",(0,i.jsx)(n.br,{}),"\n","The file ",(0,i.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/db-refresh-false.values.yaml",children:"db-refresh-false.values.yaml"})," can be found in the ",(0,i.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops",children:"ethereal-engine-ops"})," repository."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"accept-invalid-certs",children:"Accept invalid certs"}),"\n",(0,i.jsx)(o.Ay,{})]})}function m(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},5326:(e,n,s)=>{s.d(n,{Ay:()=>t,RM:()=>o});var i=s(4848),l=s(8453);const o=[];function r(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",li:"li",ol:"ol",p:"p",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"When loading the engine's website for the first time you'll have to tell your browser to ignore insecure connections."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Open the ",(0,i.jsx)(n.code,{children:"Developer Tools"})," of your browser by clicking the side menu with three dots, then go to ",(0,i.jsx)(n.code,{children:"More tools > Developer tools"})," (or use either ",(0,i.jsx)(n.code,{children:"Ctrl+Shift+I"})," or ",(0,i.jsx)(n.code,{children:"F12"}),") and then go to the ",(0,i.jsx)(n.code,{children:"Console"})," tab."]}),"\n",(0,i.jsxs)(n.li,{children:["You will see some errors in URL addresses starting with ",(0,i.jsx)(n.code,{children:"wss"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Replace ",(0,i.jsx)(n.code,{children:"wss"})," with ",(0,i.jsx)(n.code,{children:"https"})," and open that URL in a new tab"]}),"\n",(0,i.jsx)(n.li,{children:"Accept the certificate"}),"\n",(0,i.jsx)(n.li,{children:"Reload your iR Engine's tab"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["You will see some errors in URL addresses starting with ",(0,i.jsx)(n.code,{children:"https://localhost:9000"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Open the URL linked in one of those errors"}),"\n",(0,i.jsx)(n.li,{children:"Accept the certificate"}),"\n",(0,i.jsx)(n.li,{children:"Reload your iR Engine's tab"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"You need to do this for the following domains:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"wss://api-local.etherealengine.org"})," -> ",(0,i.jsx)(n.a,{href:"https://api-local.etherealengine.org",children:"https://api-local.etherealengine.org"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"wss://instanceserver-local.etherealengine.org"})," -> ",(0,i.jsx)(n.a,{href:"https://instanceserver-local.etherealengine.org",children:"https://instanceserver-local.etherealengine.org"})]}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://localhost:9000",children:"https://localhost:9000"})}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["If the engine's website keeps displaying ",(0,i.jsx)(n.code,{children:"loading routes"})," progress for a long time, it means that you have to allow the engine's certificates."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Web browsers will throw warnings when navigating to pages with unknown certificates ",(0,i.jsx)(n.em,{children:"(aka: insecure pages)"}),". You should be able to tell the browser to ignore these warnings by opening your browser's ",(0,i.jsx)(n.code,{children:"advanced options"}),", but during development it is easier to just ignore the browser's warnings and accept the default certificates."]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"Note: You will be able to create signed certificates to replace the default ones when you deploy your own iR Engine stack."})}),"\n"]})]})}function t(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(r,{...e})}):r(e)}},5651:(e,n,s)=>{s.d(n,{Ay:()=>t,RM:()=>o});var i=s(4848),l=s(8453);const o=[{value:"Install Make",id:"install-make",level:2}];function r(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"install-make",children:"Install Make"}),"\n",(0,i.jsxs)(n.p,{children:["If Make (",(0,i.jsx)(n.code,{children:"make --version"}),") is not already installed on your device, you can do so by running following commands from your Ubuntu terminal:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt-get update -y\nsudo apt-get install -y build-essential\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can verify that Make is installed correctly with the command: ",(0,i.jsx)(n.code,{children:"make --version"})]})]})}function t(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(r,{...e})}):r(e)}},8423:(e,n,s)=>{s.d(n,{Ay:()=>t,RM:()=>o});var i=s(4848),l=s(8453);const o=[{value:"Install Python 3",id:"install-python-3",level:2}];function r(e){const n={code:"code",h2:"h2",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"install-python-3",children:"Install Python 3"}),"\n",(0,i.jsxs)(n.p,{children:["If Python 3 (",(0,i.jsx)(n.code,{children:"pip3 --version"}),") is not already installed on your device, you can do so by running following commands from your Ubuntu terminal:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt-get update -y\nsudo apt-get install -y python3-pip\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can verify that Python3 is installed correctly with the command: ",(0,i.jsx)(n.code,{children:"python3 --version"}),"."]})]})}function t(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(r,{...e})}):r(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>t});var i=s(6540);const l={},o=i.createContext(l);function r(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),i.createElement(o.Provider,{value:n},e.children)}}}]);