"use strict";(self.webpackChunk_etherealengine_docs=self.webpackChunk_etherealengine_docs||[]).push([[8285],{9255:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>s,metadata:()=>i,toc:()=>d});var o=n(4848),r=n(8453);const s={},c="S3 & Cloudfront",i={id:"manual/modules/infrastructure/devopsDeployment/AWSSetup/S3Cloudfront",title:"S3 & Cloudfront",description:"Set up S3 bucket for static resources and Cloudfront distribution",source:"@site/docs/manual/03_modules/05_infrastructure/03_devopsDeployment/03_AWSSetup/11_S3Cloudfront.md",sourceDirName:"manual/03_modules/05_infrastructure/03_devopsDeployment/03_AWSSetup",slug:"/manual/modules/infrastructure/devopsDeployment/AWSSetup/S3Cloudfront",permalink:"/etherealengine-docs/manual/modules/infrastructure/devopsDeployment/AWSSetup/S3Cloudfront",draft:!1,unlisted:!1,editUrl:"https://github.com/EtherealEngine/etherealengine-docs/blob/master/docs/manual/03_modules/05_infrastructure/03_devopsDeployment/03_AWSSetup/11_S3Cloudfront.md",tags:[],version:"current",sidebarPosition:11,frontMatter:{},sidebar:"manual",previous:{title:"Notification Service",permalink:"/etherealengine-docs/manual/modules/infrastructure/devopsDeployment/AWSSetup/notifications"},next:{title:"DNS records",permalink:"/etherealengine-docs/manual/modules/infrastructure/devopsDeployment/AWSSetup/DNS"}},l={},d=[{value:"Set up S3 bucket for static resources and Cloudfront distribution",id:"set-up-s3-bucket-for-static-resources-and-cloudfront-distribution",level:2},{value:"Create S3 bucket",id:"create-s3-bucket",level:3},{value:"Create Cloudfront distribution",id:"create-cloudfront-distribution",level:3},{value:"Legacy cache settings",id:"legacy-cache-settings",level:4}];function a(e){const t={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",...(0,r.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.h1,{id:"s3--cloudfront",children:"S3 & Cloudfront"}),"\n",(0,o.jsx)(t.h2,{id:"set-up-s3-bucket-for-static-resources-and-cloudfront-distribution",children:"Set up S3 bucket for static resources and Cloudfront distribution"}),"\n",(0,o.jsx)(t.p,{children:"Various static files are stored in S3 behind a Cloudfront distribution. If you are serving the client files\nfrom the Storage Provider, then all client files will be stored and served from these as well."}),"\n",(0,o.jsx)(t.h3,{id:"create-s3-bucket",children:"Create S3 bucket"}),"\n",(0,o.jsxs)(t.p,{children:["In the AWS web client, go to S3 -> Buckets and click Create Bucket.\nName the bucket ",(0,o.jsx)(t.code,{children:"<name>-static-resources"}),", e.g. ",(0,o.jsx)(t.code,{children:"etherealengine-static-resources"}),", and have it be in Region us-east-1.\nUnder Object Ownership, select 'ACLs enabled', and under that select 'Object Writer'.\nUnder Block Public Access Settings For The Bucket, uncheck the checkbox Block ",(0,o.jsx)(t.em,{children:"all"})," Public Access;\nyou need the bucket to be publicly accessible.\nCheck the box that pops up confirming that you know the contents are public.\nAll other settings can be left to their default values; click Create Bucket."]}),"\n",(0,o.jsxs)(t.p,{children:["Open the bucket's settings and go the Permissions tab. Midway down is 'Access control list'. Edit that, and\nCheck the boxes for Objects",":List"," and Bucket ACL",":Read"," for 'Everyone (public access)'. Click the box with the\nwarning label that appears that says \"I understand the effects of these changes on my objects and buckets\",\nthen click Save Changes.\nAt the bottom of the Permissions tab is a Cross-origin Resource Sharing (CORS) box.\nIt should have the following settings; if not, click Edit and copy this in:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'[\n    {\n        "AllowedHeaders": [],\n        "AllowedMethods": [\n            "HEAD",\n            "GET",\n            "POST"\n        ],\n        "AllowedOrigins": [\n            "*"\n        ],\n        "ExposeHeaders": []\n    }\n]\n'})}),"\n",(0,o.jsx)(t.h3,{id:"create-cloudfront-distribution",children:"Create Cloudfront distribution"}),"\n",(0,o.jsx)(t.p,{children:"In the AWS web client, go to Cloudfront -> Distributions and click on Create Distribution.\nUnder 'Web', click on Get Started."}),"\n",(0,o.jsxs)(t.p,{children:["Under ",(0,o.jsx)(t.code,{children:"Origin"}),", click on the text box under ",(0,o.jsx)(t.code,{children:"Origin domain"}),", and select the name of the S3 bucket you just made.\nThe ",(0,o.jsx)(t.code,{children:"Name"})," field should be automatically populated, and should be left as whatever that value is."]}),"\n",(0,o.jsxs)(t.p,{children:["Several fields in ",(0,o.jsx)(t.code,{children:"Default cache behavior"})," will be changed."]}),"\n",(0,o.jsxs)(t.p,{children:["Under ",(0,o.jsx)(t.code,{children:"Viewer -> Viewer protocol policy"}),", select 'Redirect HTTP to HTTPS'\nUnder ",(0,o.jsx)(t.code,{children:"Viewer -> Allowed HTTP methods"}),", select 'GET, HEAD, OPTIONS', and check ",(0,o.jsx)(t.code,{children:"Cache HTTP methods -> OPTIONS"}),"."]}),"\n",(0,o.jsxs)(t.p,{children:["In ",(0,o.jsx)(t.code,{children:"Cache key and origin requests"}),", leave it on ",(0,o.jsx)(t.code,{children:"Cache policy and origin request policy"}),".\nIf this option is not available, see the below subsection for ",(0,o.jsx)(t.code,{children:"Legacy cache settings"})]}),"\n",(0,o.jsxs)(t.p,{children:["For ",(0,o.jsx)(t.code,{children:"Cache policy"}),", you will need to make a new policy, which is easily done by clicking the link ",(0,o.jsx)(t.code,{children:"Create policy"}),"\nunderneath the selector; this will open a new tab. Name this policy anything you want, e.g. 'Cached-on-headers',\nthen under ",(0,o.jsx)(t.code,{children:"Cache key settings"}),", click on the ",(0,o.jsx)(t.code,{children:"Headers"})," selector and select 'Include the following headers'. A new\nselector should appear under that titled ",(0,o.jsx)(t.code,{children:"Add header"}),". Click the selector, and check 'Origin',\n'Access-Control-Request-Method', and 'Access-Control-Request-Headers', then click away from the menu. Click the 'Create'\nbutton to create the new policy."]}),"\n",(0,o.jsxs)(t.p,{children:["Once the policy has been created, go back to the tab that you were creating the CloudFront distribution in.\nClick the refresh button to the right of the ",(0,o.jsx)(t.code,{children:"Cache policy"})," selector to fetch your new policy, then click the selector,\nand your new policy should appear in the selector at the bottom of the list under the header 'Custom'. Select it."]}),"\n",(0,o.jsxs)(t.p,{children:["For ",(0,o.jsx)(t.code,{children:"Origin request policy"}),", select the option 'CORS-S3Origin'."]}),"\n",(0,o.jsxs)(t.p,{children:["You should also make a custom response header policy so that files are served with the ",(0,o.jsx)(t.code,{children:"Origin-Agent-Cluster"}),"\nheader, which will tell most browsers to isolate resources for same-site cross-origin requests. To do that,\nyou will need to make a custom response header policy. Under ",(0,o.jsx)(t.code,{children:"Response headers policy"}),", select ",(0,o.jsx)(t.code,{children:"Create Policy"}),".\nThis will open a separate tab. Name this something like ",(0,o.jsx)(t.code,{children:"Origin-Agent-Cluster"}),", then under ",(0,o.jsx)(t.code,{children:"Custom headers"}),",\nclick ",(0,o.jsx)(t.code,{children:"Add header"}),". For name, enter ",(0,o.jsx)(t.code,{children:"Origin-Agent-Cluster"}),", and for ",(0,o.jsx)(t.code,{children:"Value"}),", enter ",(0,o.jsx)(t.code,{children:"?1"}),". Then click the ",(0,o.jsx)(t.code,{children:"Create"}),"\nbutton at the bottom."]}),"\n",(0,o.jsxs)(t.p,{children:["Go back to the tab where you were creating the Cloudfront distribution. Click the refresh button to the right of\nthe ",(0,o.jsx)(t.code,{children:"Response headers policy"})," selector to fetch the new policy, then click the selector, and your new policy should\nappear in the selector at the bottom of the list under the header ",(0,o.jsx)(t.code,{children:"Custom"}),". Select it."]}),"\n",(0,o.jsxs)(t.p,{children:["Under ",(0,o.jsx)(t.code,{children:"Settings"}),", you can change ",(0,o.jsx)(t.code,{children:"Price class"})," to 'Use Only North America and Europe' to save some money.\nFor Alternate Domain Names, click 'Add item', then in the text box that appears, enter 'resources.",(0,o.jsx)(t.code,{children:"<domain>"}),"', e.g.\n",(0,o.jsx)(t.code,{children:"resources.etherealengine.org"}),", or '<RELEASE_NAME>.",(0,o.jsx)(t.code,{children:"<domain>"}),"', e.g. ",(0,o.jsx)(t.code,{children:"dev.etherealengine.org"}),", depending on\nwhether you are serving the client files from client/API pods or the Storage Provider, respectively.\nUnder ",(0,o.jsx)(t.code,{children:"Custom SSL Certificate"}),", click on the selector that says 'Choose certificate', then select the\n'resources.",(0,o.jsx)(t.code,{children:"<domain>"}),"'/'",(0,o.jsx)(t.code,{children:"<RELEASE_NAME>.<domain>"}),"' certificate you made earlier. If you are serving the client\nfiles from the Storage Provider, under ",(0,o.jsx)(t.code,{children:"Default root object"}),", enter ",(0,o.jsx)(t.code,{children:"client/index.html"}),"; if you are serving\nthe client files from client/API pods, leave this blank."]}),"\n",(0,o.jsx)(t.p,{children:"Everything else can be left at the default values, click Create Distribution."}),"\n",(0,o.jsx)(t.h4,{id:"legacy-cache-settings",children:"Legacy cache settings"}),"\n",(0,o.jsxs)(t.p,{children:["If for some reason ",(0,o.jsx)(t.code,{children:"Cache policy and origin request policy"})," is not available for you, and you have to use\n",(0,o.jsx)(t.code,{children:"Legacy cache settings"}),", the under ",(0,o.jsx)(t.code,{children:"Headers"}),", select 'Include the following headers'. Under ",(0,o.jsx)(t.code,{children:"Add header"})," that appears,\nclick on the selector titled 'Select headers', and in the menu that opens, check 'Host', 'Origin',\n'Access-Control-Request-Method', and 'Access-Control-Request-Headers', then click away."]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>c,x:()=>i});var o=n(6540);const r={},s=o.createContext(r);function c(e){const t=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),o.createElement(s.Provider,{value:t},e.children)}}}]);