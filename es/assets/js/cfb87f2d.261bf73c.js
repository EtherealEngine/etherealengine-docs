"use strict";(self.webpackChunk_etherealengine_docs=self.webpackChunk_etherealengine_docs||[]).push([[7163],{3171:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>c});var o=t(4848),s=t(8453),r=t(8020);const i={},l="iR Engine on Docker Desktop",a={id:"manual/modules/infrastructure/devopsDeployment/dockerDesktop",title:"iR Engine on Docker Desktop",description:"NOTE: UDP networking does not work properly on Docker Desktop as of this writing, as Docker Desktop does not expose the IP addresses/ports of the node publicly, so mediasoup cannot connect over UDP. If you want to test audio/video calling or networked movements, please use minikube.",source:"@site/docs/manual/03_modules/05_infrastructure/03_devopsDeployment/02_dockerDesktop.md",sourceDirName:"manual/03_modules/05_infrastructure/03_devopsDeployment",slug:"/manual/modules/infrastructure/devopsDeployment/dockerDesktop",permalink:"/etherealengine-docs/es/manual/modules/infrastructure/devopsDeployment/dockerDesktop",draft:!1,unlisted:!1,editUrl:"https://github.com/EtherealEngine/etherealengine-docs/blob/master/docs/manual/03_modules/05_infrastructure/03_devopsDeployment/02_dockerDesktop.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{},sidebar:"manual",previous:{title:"iR Engine on MicroK8s (Windows)",permalink:"/etherealengine-docs/es/manual/modules/infrastructure/devopsDeployment/microk8s_windows"},next:{title:"iR Engine on Minikube",permalink:"/etherealengine-docs/es/manual/modules/infrastructure/devopsDeployment/minikube"}},d={},c=[{value:"Install kubectl, Helm, and Docker Desktop",id:"install-kubectl-helm-and-docker-desktop",level:2},{value:"Clone iR Engine repo to your local machine",id:"clone-ir-engine-repo-to-your-local-machine",level:2},{value:"Start MinIO &amp; MariaDB server locally via Docker",id:"start-minio--mariadb-server-locally-via-docker",level:2},{value:"Enable Kubernetes in Docker Desktop",id:"enable-kubernetes-in-docker-desktop",level:2},{value:"Edit system hostfile to point EtherealEngine addresses to 127.0.0.1",id:"edit-system-hostfile-to-point-etherealengine-addresses-to-127001",level:2},{value:"Add Helm repos",id:"add-helm-repos",level:2},{value:"Install Agones and Redis deployments",id:"install-agones-and-redis-deployments",level:2},{value:"Run build_docker_desktop.sh",id:"run-build_docker_desktopsh",level:2},{value:"Update Helm Values File",id:"update-helm-values-file",level:2},{value:"Deploy iR Engine Helm chart",id:"deploy-ir-engine-helm-chart",level:2},{value:"Accept invalid certs",id:"accept-invalid-certs",level:2},...r.RM];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",p:"p",pre:"pre",strong:"strong",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"ir-engine-on-docker-desktop",children:"iR Engine on Docker Desktop"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"NOTE"}),": ",(0,o.jsx)(n.em,{children:"UDP networking does not work properly on Docker Desktop as of this writing, as Docker Desktop does not expose the IP addresses/ports of the node publicly, so mediasoup cannot connect over UDP. If you want to test audio/video calling or networked movements, please use minikube."})]}),"\n",(0,o.jsx)(n.h2,{id:"install-kubectl-helm-and-docker-desktop",children:"Install kubectl, Helm, and Docker Desktop"}),"\n",(0,o.jsxs)(n.p,{children:["If ",(0,o.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/tools/",children:"kubectl"}),", ",(0,o.jsx)(n.a,{href:"https://helm.sh/docs/intro/install/",children:"Helm"}),", and/or ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/desktop/install/linux-install/",children:"Docker Desktop"})," aren't already installed on your machine, install them. Windows and Mac Docker Desktop installation instructions can be found ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/desktop/install/windows-install/",children:"here"})," and ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/desktop/install/mac-install/",children:"here"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["You may also need to install ",(0,o.jsx)(n.a,{href:"https://docs.docker.com/compose/install/",children:"Docker Compose"})]}),"\n",(0,o.jsx)(n.h2,{id:"clone-ir-engine-repo-to-your-local-machine",children:"Clone iR Engine repo to your local machine"}),"\n",(0,o.jsxs)(n.p,{children:["To build the iR Engine Docker image locally, and to have a pre-tested way to run various local\nservices, you'll need to get the iR Engine repo on your machine. This is most easily\ndone by running ",(0,o.jsx)(n.code,{children:"git clone https://github.com/etherealengine/etherealengine.git"})]}),"\n",(0,o.jsx)(n.h2,{id:"start-minio--mariadb-server-locally-via-docker",children:"Start MinIO & MariaDB server locally via Docker"}),"\n",(0,o.jsx)(n.p,{children:"For simplicity, we recommend running MinIO & MariaDB server on your local machine outside of MicroK8s."}),"\n",(0,o.jsxs)(n.p,{children:["If you run ",(0,o.jsx)(n.code,{children:"docker-compose up"})," from the top-level ",(0,o.jsx)(n.code,{children:"/scripts"})," directory in the iR Engine repo, it will start up MinIO & multiple MariaDB docker containers (as well as a redis server, which is not needed). For mariadb containers, one is intended for local development, runs on port 3306; another, intended for automated testing purposes, runs on port 3305; and the last one, intended for minikube/microk8s testing, runs on port 3304. Once the docker container is stopped, you can start it again by running ",(0,o.jsx)(n.code,{children:"npm run dev-docker"}),"."]}),"\n",(0,o.jsxs)(n.p,{children:["Alternatively, if you want to just run MinIO & MariaDB on its own without Docker, that's fine too. You'll just have to configure the Helm config file to have the appropriate S3 & SQL server configuration, and possibly change the script ",(0,o.jsx)(n.code,{children:"./scripts/build_minikube.sh"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"enable-kubernetes-in-docker-desktop",children:"Enable Kubernetes in Docker Desktop"}),"\n",(0,o.jsxs)(n.p,{children:["Inside Docker Desktop, go to Settings. There should be a section for Kubernetes (as of this writing, located\nbetween ",(0,o.jsx)(n.code,{children:"Docker Engine"})," and ",(0,o.jsx)(n.code,{children:"Software updates"})," settings). Click on that, then check the checkbox for Enable Kuberentes,\nand then click the button Apply and restart. When Docker Desktop restarts, it should now run a minikube-like Kubernetes\ncluster on startup. The Kubernetes context for this should be named ",(0,o.jsx)(n.code,{children:"docker-desktop"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"edit-system-hostfile-to-point-etherealengine-addresses-to-127001",children:"Edit system hostfile to point EtherealEngine addresses to 127.0.0.1"}),"\n",(0,o.jsxs)(n.p,{children:["You'll need to edit your hostfile to point certain domains to 127.0.0.1, which is how Docker Desktop routes traffic\nto its Kubernetes cluster. On Linux, this is done by running ",(0,o.jsx)(n.code,{children:"sudo gedit /etc/hosts"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"Add the following line:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"127.0.0.1  local.etherealengine.org api-local.etherealengine.org instanceserver-local.etherealengine.org 00000.instanceserver-local.etherealengine.org 00001.instanceserver-local.etherealengine.org 00002.instanceserver-local.etherealengine.org 00003.instanceserver-local.etherealengine.org\n"})}),"\n",(0,o.jsx)(n.p,{children:"You should also see a section that looks like this:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"# Added by Docker Desktop\n# To allow the same kube context to work on the host and the container:\n127.0.0.1\tkubernetes.docker.internal\n# End of section\n"})}),"\n",(0,o.jsx)(n.p,{children:"The first line says to point several *-local.etherealengine.org domains internally to the Kubernetes cluster,\nwhere the nginx ingress server will redirect the traffic to the appropriate pod.\nThe section it automatically added is used for giving Docker containers, including the Kubernetes cluster,\naccess to the host machine."}),"\n",(0,o.jsx)(n.p,{children:"Make sure to save this file after you've edited it. On Linux, at least, you need root permissions\nto edit it."}),"\n",(0,o.jsx)(n.h2,{id:"add-helm-repos",children:"Add Helm repos"}),"\n",(0,o.jsx)(n.p,{children:"You'll need to add a few Helm repos. Run the following:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"helm repo add agones https://agones.dev/chart/stable\nhelm repo add redis https://charts.bitnami.com/bitnami\nhelm repo add etherealengine https://helm.etherealengine.org\n"})}),"\n",(0,o.jsx)(n.p,{children:"This will add the Helm charts for Agones, Redis, and iR Engine, respectively."}),"\n",(0,o.jsx)(n.h2,{id:"install-agones-and-redis-deployments",children:"Install Agones and Redis deployments"}),"\n",(0,o.jsx)(n.p,{children:"After adding those Helm repos, you'll start installing deployments using Helm repos."}),"\n",(0,o.jsxs)(n.p,{children:["Make sure that kubectl is pointed at docker-desktop by running ",(0,o.jsx)(n.code,{children:"kubectl config current-context"}),",\nwhich should say 'docker-desktop'. You can also run ",(0,o.jsx)(n.code,{children:"kubectl config get-contexts"})," to get all contexts\nthat kubectl has been configured to run; the current one will have a '*' under the left-most\n'current' column."]}),"\n",(0,o.jsxs)(n.p,{children:["Once kubectl is pointed to docker-desktop, from the top of the iR Engine repo, run\n",(0,o.jsx)(n.code,{children:"helm install -f </path/to/agones-default-values.yaml> agones agones/agones"})," to install Agones\nand ",(0,o.jsx)(n.code,{children:"helm install local-redis redis/redis"})," to install redis."]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/agones-default-values.yaml",children:"agones-default-values.yaml"})," can be found in ",(0,o.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops",children:"ethereal-engine-ops"})," repo."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["You can run ",(0,o.jsx)(n.code,{children:"kubectl get pods -A"})," to list all of the pods running in docker-desktop. After a minute or so,\nall of these pods should be in the Running state."]}),"\n",(0,o.jsx)(n.h2,{id:"run-build_docker_desktopsh",children:"Run build_docker_desktop.sh"}),"\n",(0,o.jsx)(n.p,{children:"When docker desktop's Kubernetes cluster is running, run the following command from the root of the iR Engine repo:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"./scripts/build_docker_desktop.sh\n"})}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["If you face issue related to ",(0,o.jsx)(n.code,{children:'"packages/projects/projects/" does not exist'})," then run following commands in your terminal:"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"export MYSQL_HOST=localhost\nnpm run dev-docker\nnpm run dev-reinit\nnpx ts-node --swc scripts/install-projects.js\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The script builds the full-repo Docker image using several build arguments. Vite, which builds\nthe client files, uses some information from the MariaDB database created for local K8s deployments\nto fill in some variables, and needs database credentials. The script will supply default values\nfor all of the MYSQL_* variables if they are not provided to the script, as well as VITE_CLIENT_HOST,\nVITE_SERVER_HOST, and VITE_INSTANCESERVER_HOST. The latter three will make your Docker Desktop K8s deployment\naccessible on ",(0,o.jsx)(n.code,{children:"(local/api-local/instanceserver-local).etherealengine.org"}),"; if you want to run it on a different\ndomain, then you'll have to set those three environment variables to what you want them to be (and also\nchange the hostfile records you made pointing those subdomains to 127.0.0.1)"]}),"\n",(0,o.jsx)(n.p,{children:"This will build an image of the entire iR Engine repo into a single Docker file. When deployed for\ndifferent services, it will only run the parts needed for that service. This may take up to 15 minutes,\nthough later builds should take less time as things are cached."}),"\n",(0,o.jsx)(n.h2,{id:"update-helm-values-file",children:"Update Helm Values File"}),"\n",(0,o.jsxs)(n.p,{children:["This will use a Helm config file titled 'local.values.yaml' to configure the deployment. There is\na ",(0,o.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/local.dockerdesktop.template.values.yaml",children:"template"})," for this file in ",(0,o.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops",children:"ethereal-engine-ops"})," repo."]}),"\n",(0,o.jsxs)(n.p,{children:["If you are using local file server as explained a couple of steps earlier then, update 'local.values.yaml' variable ",(0,o.jsx)(n.code,{children:"api.fileServer.hostUploadFolder"})," with value e.g. '/hosthome/<OS_USER_NAME>/<ENGINE_FOLDER>/packages/server/upload'. The folder must be in home folder and make sure to use /hosthome/ instead of home in path. It's mandatory to point to ",(0,o.jsx)(n.code,{children:"/packages/server/upload"})," folder of your engine folder."]}),"\n",(0,o.jsx)(n.h2,{id:"deploy-ir-engine-helm-chart",children:"Deploy iR Engine Helm chart"}),"\n",(0,o.jsxs)(n.p,{children:["Run the following command: ",(0,o.jsx)(n.code,{children:"helm install -f </path/to/local.values.yaml> -f </path/to/db-refresh-true.values.yaml> local etherealengine/etherealengine"}),"."]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/db-refresh-true.values.yaml",children:"db-refresh-true.values.yaml"})," can be found in ",(0,o.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops",children:"ethereal-engine-ops"})," repo."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["After a minute or so, running ",(0,o.jsx)(n.code,{children:"kubectl get pods"})," should show one or more instanceservers, one or more api\nservers, and one client server in the Running state. Setting ",(0,o.jsx)(n.code,{children:"FORCE_DB_REFRESH=true"})," made the api servers\n(re)initialize the database. Since you don't want that to happen every time a new api pod starts, run\n",(0,o.jsx)(n.code,{children:"helm upgrade --reuse-values -f </path/to/db-refresh-false.values.yaml> local etherealengine/etherealengine"}),".\nThe API pods will restart and will now not attempt to reinit the database on boot."]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/db-refresh-false.values.yaml",children:"db-refresh-false.values.yaml"})," can be found in ",(0,o.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops",children:"ethereal-engine-ops"})," repo."]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"accept-invalid-certs",children:"Accept invalid certs"}),"\n",(0,o.jsx)(r.Ay,{})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(h,{...e})}):h(e)}},8020:(e,n,t)=>{t.d(n,{Ay:()=>l,RM:()=>r});var o=t(4848),s=t(8453);const r=[];function i(e){const n={a:"a",blockquote:"blockquote",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.p,{children:"Since there are no valid certificates for this domain, you'll have to tell your browser to ignore the insecure connections when you try to load the application."}),"\n",(0,o.jsxs)(n.p,{children:["Go to <",(0,o.jsx)(n.a,{href:"https://local.etherealengine.org/%3E",children:"https://local.etherealengine.org/>"}),", you should see a warning about an invalid certificate; accept this invalid cert to get to the home page. Next if it keeps displaying 'loading routes' progress for a long time, it is due to the fact that you have to allow certificates. You'll have to open the dev tools for your browser and go to the 'Console' tab. You will see some errors in URL address starting with 'wss'. Replace 'wss' with 'https' and open it in new tab. Accept the certificate and reload your iR Engine tab. You need to do this for following domains:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["wss://api-local.etherealengine.org -> ",(0,o.jsx)(n.a,{href:"https://api-local.etherealengine.org",children:"https://api-local.etherealengine.org"})]}),"\n",(0,o.jsxs)(n.li,{children:["wss://instanceserver-local.etherealengine.org -> ",(0,o.jsx)(n.a,{href:"https://instanceserver-local.etherealengine.org",children:"https://instanceserver-local.etherealengine.org"})]}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://localhost:9000",children:"https://localhost:9000"})}),"\n"]}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"You can open Developer tools in Chrome by clicking the side menu with three dots, then More tools > Developer tools (or use Ctrl+Shift+I)"}),"\n"]})]})}function l(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(i,{...e})}):i(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>l});var o=t(6540);const s={},r=o.createContext(s);function i(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);