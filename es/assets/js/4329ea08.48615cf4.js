"use strict";(self.webpackChunk_etherealengine_docs=self.webpackChunk_etherealengine_docs||[]).push([[6113],{6810:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>l,metadata:()=>h,toc:()=>d});var o=t(4848),i=t(8453),r=t(9263),s=t(7152);const l={},a="Queries",h={id:"developer/typescript/gettingStarted/hello/query",title:"Queries",description:"Queries are a tool provided by the Entity Component System pattern used by iR Engine.",source:"@site/docs/developer/typescript/01_gettingStarted/02_hello/05_query.md",sourceDirName:"developer/typescript/01_gettingStarted/02_hello",slug:"/developer/typescript/gettingStarted/hello/query",permalink:"/etherealengine-docs/es/developer/typescript/gettingStarted/hello/query",draft:!1,unlisted:!1,editUrl:"https://github.com/EtherealEngine/etherealengine-docs/blob/master/docs/developer/typescript/01_gettingStarted/02_hello/05_query.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{},sidebar:"typescript",previous:{title:"Components",permalink:"/etherealengine-docs/es/developer/typescript/gettingStarted/hello/component"},next:{title:"What's Next",permalink:"/etherealengine-docs/es/developer/typescript/gettingStarted/hello/congrats"}},c={},d=[{value:"Creating a Query",id:"creating-a-query",level:2},{value:"Using our Query",id:"using-our-query",level:2},{value:"Loading the Component",id:"loading-the-component",level:2},{value:"Confirm the Code",id:"confirm-the-code",level:2},{value:"Conclusion",id:"conclusion",level:2}];function u(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",br:"br",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.h1,{id:"queries",children:"Queries"}),"\n",(0,o.jsxs)(n.p,{children:["Queries are a tool provided by the ",(0,o.jsx)(n.code,{children:"Entity Component System"})," pattern used by iR Engine."]}),"\n",(0,o.jsxs)(n.p,{children:["In simple terms, a Query is a function that will request all entities that match a certain condition.",(0,o.jsx)(n.br,{}),"\n","More specifically, it will return ",(0,o.jsx)(n.strong,{children:"all"})," entities that contain ",(0,o.jsx)(n.strong,{children:"all"})," Components in the list that we specify."]}),"\n",(0,o.jsx)(n.h2,{id:"creating-a-query",children:"Creating a Query"}),"\n",(0,o.jsxs)(n.p,{children:["We are going to ",(0,o.jsx)(n.strong,{children:"define a Query"}),". I think you can figure out the name of the function already :)",(0,o.jsx)(n.br,{}),"\n","This is how the function works:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["We give the function an ",(0,o.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array",children:"array"})," of Components"]}),"\n",(0,o.jsx)(n.li,{children:"The function will give us back a Query function"}),"\n",(0,o.jsx)(n.li,{children:"We can call the given function to retrieve all entities that contain the components that we specified."}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{title:"notes",type:"note",children:(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"We need to send an array anyway, even if it only contains a single Component."}),"\n",(0,o.jsxs)(n.li,{children:["The Query will match only those entities that contain ",(0,o.jsx)(n.strong,{children:"all"})," components in our list."]}),"\n",(0,o.jsx)(n.li,{children:"We don't need to export the Query function, as it will only be called by our own code."}),"\n"]})}),"\n",(0,o.jsx)(n.p,{children:"Here are your hints for this assignment:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"// Define the query that will find our Scene's Entity\nconst queryName = NAMESPACE.funtionName([ CustomComponentName ])\n"})}),"\n",(0,o.jsx)(r.W,{title:"Solution",children:(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"// Define the query that will find our Scene's Entity\nconst helloQuery = ECS.defineQuery([HelloComponent])\n"})})}),"\n",(0,o.jsxs)(n.p,{children:["Same as before, if you run the project as it is now you won't see any changes just yet.",(0,o.jsx)(n.br,{}),"\n","We have defined the Query that will search for our Scene's entity, but we haven't called it yet."]}),"\n",(0,o.jsx)(n.h2,{id:"using-our-query",children:"Using our Query"}),"\n",(0,o.jsxs)(n.p,{children:["A Query, when called, will return a ",(0,o.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Iterators_and_Generators#generator_functions",children:"JavaScript Generator"}),".",(0,o.jsx)(n.br,{}),"\n","This Generator can be used to access the list of all entities that match the list of Components that we specified."]}),"\n",(0,o.jsxs)(n.p,{children:["This means that we can access as many entities as we want from a single unified place!",(0,o.jsx)(n.br,{}),"\n","Really powerful."]}),"\n",(0,o.jsxs)(n.p,{children:["I gave you one solution for free earlier, but I'm leaving this assignment a bit ambiguous on purpose.",(0,o.jsx)(n.br,{}),"\n","I will give you three options. Pick the one that fits your learning style best:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:["Challenge:",(0,o.jsx)(n.br,{}),"\n","See if you can figure out which part of your code goes where before looking at the solution or the hints. It will be very difficult."]}),"\n",(0,o.jsxs)(n.li,{children:["Intermediate difficulty:",(0,o.jsx)(n.br,{}),"\n","Open each hint one by one, and take some time to reason about what the hint is trying to say before opening the next one.",(0,o.jsx)(n.br,{}),"\n","You might land on the solution earlier than you think."]}),"\n",(0,o.jsxs)(n.li,{children:["Otherwise:",(0,o.jsx)(n.br,{}),"\n","Read the hints, try to understand them a bit, and then compare what you thought with the full solution."]}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"Here are your hints:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"// Our for loop will look something like this\nfor (const entity of /* queryName() */) {\n  // Our code goes here ...\n}\n"})}),"\n",(0,o.jsxs)(r.W,{title:"Hints",children:[(0,o.jsxs)(n.p,{children:["This step is really difficult without hints. Don't worry if you cannot figure it out on your own.",(0,o.jsx)(n.br,{}),"\n","There is a lot to process, so what matters most is that you think it through."]}),(0,o.jsxs)(s.B,{title:"1. JavaScript Generator",children:[(0,o.jsxs)(n.p,{children:["Generators are called as if they were functions with no arguments, and they will ",(0,o.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/yield",children:(0,o.jsx)(n.code,{children:"yield"})})," the next entry of the list on every iteration."]}),(0,o.jsxs)(n.p,{children:["So, our ",(0,o.jsx)(n.code,{children:"for"})," loop should say:"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"for (const entity in helloQuery()) {\n  // do something for every entity\n}\n"})})]}),(0,o.jsx)(s.B,{title:"2. For Loop",children:(0,o.jsxs)(n.p,{children:["We cannot store our ",(0,o.jsx)(n.code,{children:"initialized"})," variable in module scope anymore.",(0,o.jsx)(n.br,{}),"\n","And the code right above cannot be at the top level of your file either.",(0,o.jsx)(n.br,{}),"\n","It ",(0,o.jsx)(n.strong,{children:"must"})," be inside a function."]})}),(0,o.jsx)(s.B,{title:"3. Continue",children:(0,o.jsxs)(n.p,{children:["Remember the hint from earlier about the ",(0,o.jsx)(n.code,{children:"continue"})," keyword?",(0,o.jsx)(n.br,{}),"\n","If not, ",(0,o.jsx)(n.a,{href:"./component#state-management",children:"go back"})," and read it again. You really need it now."]})}),(0,o.jsx)(s.B,{title:"4. State Management",children:(0,o.jsxs)(n.p,{children:['Now is the moment when you need to add the code that I gave you "for free" earlier.',(0,o.jsx)(n.br,{}),"\n","Notice how the hint code above is giving you a ",(0,o.jsx)(n.code,{children:"for"})," loop, and the State Management code has a ",(0,o.jsx)(n.code,{children:"continue"})," keyword. They go together."]})}),(0,o.jsx)(s.B,{title:"5. Initialized Variable",children:(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"initialized"})," variable from before cannot exist anymore.",(0,o.jsx)(n.br,{}),"\n","The state management code replaces it."]})}),(0,o.jsx)(s.B,{title:"6. System Execute",children:(0,o.jsxs)(n.p,{children:["The state management code ",(0,o.jsx)(n.strong,{children:"must"})," be placed inside our ",(0,o.jsx)(n.code,{children:"execute"})," function."]})}),(0,o.jsxs)(s.B,{title:"7. Entity Creation and Loop",children:[(0,o.jsxs)(n.p,{children:["We need to execute some code for an entity, just like we did before.",(0,o.jsx)(n.br,{}),"\n","That hasn't changed."]}),(0,o.jsxs)(n.p,{children:["But you cannot use ",(0,o.jsx)(n.code,{children:"createEntity"})," anymore.",(0,o.jsx)(n.br,{}),"\n","The entity is ",(0,o.jsx)(n.code,{children:"requested"})," by the Query, not created."]}),(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"hello-final"})," scene already contains the entity.",(0,o.jsx)(n.br,{}),"\n","Scroll down to the ",(0,o.jsx)(n.code,{children:"Loading the Component"})," section right below if you are confused as to why this is the case."]}),"\n"]})]}),(0,o.jsxs)(s.B,{title:"8. Source Code Order",children:[(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Import the engine modules"}),"\n",(0,o.jsx)(n.li,{children:"Define a Component"}),"\n",(0,o.jsx)(n.li,{children:"Define a Query that will request entities that contain that Component"}),"\n",(0,o.jsx)(n.li,{children:"Create a function that runs our code"}),"\n",(0,o.jsxs)(n.li,{children:["Loop through all entities, and do something for each",(0,o.jsx)(n.br,{}),"\n",(0,o.jsx)(n.em,{children:"(We only have one, but we loop anyway)"})]}),"\n",(0,o.jsx)(n.li,{children:"Make sure that we only execute our code once for each entity"}),"\n",(0,o.jsx)(n.li,{children:"Define a System"}),"\n",(0,o.jsxs)(n.li,{children:["Set our function as the System's ",(0,o.jsx)(n.code,{children:"execute"})," function"]}),"\n"]}),(0,o.jsxs)(n.p,{children:["You already have the code for #1, #2, #3, #6 and #7 from before.",(0,o.jsx)(n.br,{}),"\n","We are creating #5 with this step.",(0,o.jsx)(n.br,{}),"\n","We are also modifying #4:"]}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"The initialized variable is replaced with the State Management code I gave you"}),"\n",(0,o.jsxs)(n.li,{children:["The State Management code ",(0,o.jsx)(n.strong,{children:"must"})," placed inside the new #5 loop"]}),"\n"]})]})]}),"\n",(0,o.jsxs)(r.W,{title:"Solution",children:[(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"function hello() {\n  //highlight-start\n  for (const entity of helloQuery()) {\n    //highlight-end\n\n    //highlight-start\n    // Check if we have already initialized our Sphere\n    let { initialized } = ECS.getMutableComponent(entity, HelloComponent)\n    if (initialized.value) continue\n    initialized.set(true)  // Set our initialized state to true\n    //highlight-end\n\n    ECS.setComponent(entity, NameComponent, 'ee.tutorial.hello-entity')\n    ECS.setComponent(entity, VisibleComponent)\n    ECS.setComponent(entity, TransformComponent, { position: new Vector3(0, 1, 0) })\n    ECS.setComponent(entity, PrimitiveGeometryComponent, { geometryType: GeometryTypeEnum.SphereGeometry })\n  }\n}\n"})}),(0,o.jsxs)(s.B,{title:"Full Solution",children:[(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:'title="ee-tutorial-hello/src/Hello.ts" showLineNumbers',children:"import { ECS } from '@etherealengine/ecs'\nimport { NameComponent } from '@etherealengine/spatial/src/common/NameComponent'\nimport { VisibleComponent } from '@etherealengine/spatial/src/renderer/components/VisibleComponent'\nimport { TransformComponent } from '@etherealengine/spatial/src/transform/components/TransformComponent'\nimport { PrimitiveGeometryComponent } from '@etherealengine/engine/src/scene/components/PrimitiveGeometryComponent'\nimport { Vector3 } from 'three'\nimport { GeometryTypeEnum } from '@etherealengine/engine/src/scene/constants/GeometryTypeEnum'\nimport { PhysicsSystem } from '@etherealengine/spatial'\n\n// Define our component\n//highlight-start\nexport const HelloComponent = ECS.defineComponent({\n  name: 'ee.tutorial.HelloComponent',\n  jsonID: 'EE_tutorial_hello',\n  onInit: () => { return { initialized: false } }\n})\n//highlight-end\n\n// Define the query that will find our Scene's Entity\n//highlight-start\nconst helloQuery = ECS.defineQuery([HelloComponent])\n//highlight-end\n\nconst hello = () => {\n  //highlight-start\n  for (const entity of helloQuery()) {\n    // Check if we have already initialized our Sphere\n    let { initialized } = ECS.getMutableComponent(entity, HelloComponent)\n    if (initialized.value) continue\n    initialized.set(true)  // Set our initialized state to true\n    //highlight-end\n\n    ECS.setComponent(entity, NameComponent, 'ee.tutorial.hello-entity')\n    ECS.setComponent(entity, VisibleComponent)\n    ECS.setComponent(entity, TransformComponent, { position: new Vector3(0, 1, 0) })\n    ECS.setComponent(entity, PrimitiveGeometryComponent, { geometryType: GeometryTypeEnum.SphereGeometry })\n  }\n}\n\n// Define our system\nexport const HelloSystem = ECS.defineSystem({\n  uuid: 'ee.tutorial.HelloSystem',\n  execute: hello,\n  insert: { after: PhysicsSystem }\n})\n"})}),(0,o.jsxs)(n.p,{children:["Notice how I have changed the code to use an arrow function.",(0,o.jsx)(n.br,{}),"\n","They can be used interchangeably, so feel free to use either of them."]}),(0,o.jsxs)(n.p,{children:["Also, notice how the style of the names in this solution has been changed.",(0,o.jsx)(n.br,{}),"\n","We will learn about them next."]})]})]}),"\n",(0,o.jsx)(n.h2,{id:"loading-the-component",children:"Loading the Component"}),"\n",(0,o.jsx)(n.p,{children:"Now, here is a question:"}),"\n",(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:"How do we connect our custom scene Component to the scene?"}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The answer is that there is one last piece of the project that we haven't talked about just yet.",(0,o.jsx)(n.br,{}),"\n","You might have even seen it in the Studio already if you explored a bit!"]}),"\n",(0,o.jsxs)(n.p,{children:["We don't know how to add a Component to an entity through the Studio yet, or how to make our Component show up on the ",(0,o.jsx)(n.code,{children:"Add Component"})," Studio UI.",(0,o.jsx)(n.br,{}),"\n","And we have gone through two entire pages with a LOT of theory but not a whole lot of practice.",(0,o.jsx)(n.br,{}),"\n","So I already solved this problem for you."]}),"\n",(0,o.jsxs)(n.p,{children:["When you open the ",(0,o.jsx)(n.code,{children:"ee-tutorial-hello"})," project... there is a scene called ",(0,o.jsx)(n.code,{children:"hello-final"})," in there.",(0,o.jsx)(n.br,{}),"\n","That's what we are looking for :)"]}),"\n",(0,o.jsxs)(n.p,{children:["Thanks to how the ",(0,o.jsx)(n.code,{children:"hello-final"})," scene is setup, our Component will work in that Scene... but it will not work anywhere else! Really neat."]}),"\n",(0,o.jsxs)(r.W,{children:[(0,o.jsx)(n.p,{children:"What I did, exactly, was:"}),(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"I added an entity to the scene"}),"\n",(0,o.jsx)(n.li,{children:"I added the component we are Quering for to the entity"}),"\n",(0,o.jsx)(n.li,{children:"I saved the scene into the project"}),"\n"]}),(0,o.jsx)(n.p,{children:"This means that, when you installed the project with the Quickstart guide, you also downloaded the final scene that we need."})]}),"\n",(0,o.jsx)(n.h2,{id:"confirm-the-code",children:"Confirm the Code"}),"\n",(0,o.jsxs)(n.p,{children:["You will know that you have completed the ",(0,o.jsx)(n.a,{href:"./component",children:"Components"})," and ",(0,o.jsx)(n.a,{href:"./query",children:"Queries"})," tasks correctly if:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["The behavior has not changed for the ",(0,o.jsx)(n.code,{children:"hello-final"})," scene. You can still see the sphere in the Scene."]}),"\n",(0,o.jsxs)(n.li,{children:["You open another scene ",(0,o.jsxs)(n.em,{children:["(eg: ",(0,o.jsx)(n.code,{children:"default-project/appartment"})," provided by the engine)"]}),"...",(0,o.jsx)(n.br,{}),"\n","and the Sphere is gone!"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"conclusion",children:"Conclusion"}),"\n",(0,o.jsxs)(n.p,{children:["As you can see, we only added around 10 lines of code in these last two pages...",(0,o.jsx)(n.br,{}),"\n","But we introduced so many new concepts!",(0,o.jsx)(n.br,{}),"\n","That's the most exciting part about the ECS pattern. You can do ",(0,o.jsx)(n.strong,{children:"so"})," much with so little code."]}),"\n",(0,o.jsxs)(n.p,{children:["I hope you didn't struggle too much with the last task. I know it was a difficult one.",(0,o.jsx)(n.br,{}),"\n","But I promise that, now that you have this knowledge, the road ahead will only get easier and easier."]}),"\n",(0,o.jsx)(n.p,{children:"Lets see what we will learn next!"})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(u,{...e})}):u(e)}},9263:(e,n,t)=>{t.d(n,{W:()=>r});var o=t(6540),i=t(4848);const r=e=>{const n=e.title?e.title:"Technical Note";return(0,i.jsx)(o.Fragment,{children:(0,i.jsxs)("details",{className:"alert alert--secondary mb-5 bg-neutral-900",children:[(0,i.jsx)("summary",{className:"text-blue-200 hover:cursor-pointer",children:n}),(0,i.jsx)("div",{className:"pt-4",children:e.children})]})})}},7152:(e,n,t)=>{t.d(n,{B:()=>r});var o=t(6540),i=t(4848);const r=e=>{const n=e.title;return(0,i.jsx)(o.Fragment,{children:(0,i.jsxs)("details",{className:"mb-5",children:[(0,i.jsx)("summary",{className:"text-blue-200 hover:cursor-pointer",children:n}),(0,i.jsx)("div",{className:"pt-4",children:e.children})]})})}},8453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>l});var o=t(6540);const i={},r=o.createContext(i);function s(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);