"use strict";(self.webpackChunk_etherealengine_docs=self.webpackChunk_etherealengine_docs||[]).push([[5690],{209:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});var t=s(4848),i=s(8453);const a={},o="Agones, ingress-nginx and Redis",r={id:"manual/modules/infrastructure/devopsDeployment/AWSSetup/agonesNginxRedis",title:"Agones, ingress-nginx and Redis",description:"Install Agones, ingress-nginx, and a copy of redis for each deployment",source:"@site/docs/manual/03_modules/05_infrastructure/03_devopsDeployment/03_AWSSetup/08_agonesNginxRedis.md",sourceDirName:"manual/03_modules/05_infrastructure/03_devopsDeployment/03_AWSSetup",slug:"/manual/modules/infrastructure/devopsDeployment/AWSSetup/agonesNginxRedis",permalink:"/etherealengine-docs/es/manual/modules/infrastructure/devopsDeployment/AWSSetup/agonesNginxRedis",draft:!1,unlisted:!1,editUrl:"https://github.com/EtherealEngine/etherealengine-docs/blob/master/docs/manual/03_modules/05_infrastructure/03_devopsDeployment/03_AWSSetup/08_agonesNginxRedis.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{},sidebar:"manual",previous:{title:"Route 53",permalink:"/etherealengine-docs/es/manual/modules/infrastructure/devopsDeployment/AWSSetup/route53"},next:{title:"Email Service",permalink:"/etherealengine-docs/es/manual/modules/infrastructure/devopsDeployment/AWSSetup/email"}},l={},d=[{value:"Install Agones, ingress-nginx, and a copy of redis for each deployment",id:"install-agones-ingress-nginx-and-a-copy-of-redis-for-each-deployment",level:2},{value:"Install Agones",id:"install-agones",level:3},{value:"Install redis for each deployment",id:"install-redis-for-each-deployment",level:3},{value:"Installing redis as part of iR Engine chart (not recommended for production)",id:"installing-redis-as-part-of-ir-engine-chart-not-recommended-for-production",level:4},{value:"Install ingress-nginx",id:"install-ingress-nginx",level:3}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",p:"p",strong:"strong",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"agones-ingress-nginx-and-redis",children:"Agones, ingress-nginx and Redis"}),"\n",(0,t.jsx)(n.h2,{id:"install-agones-ingress-nginx-and-a-copy-of-redis-for-each-deployment",children:"Install Agones, ingress-nginx, and a copy of redis for each deployment"}),"\n",(0,t.jsxs)(n.p,{children:["Now that the cluster is up and running, we can install everything onto it.\nWhen you created the cluster with eksctl, it should have created a context pointing to\nit in kubectl. Run ",(0,t.jsx)(n.code,{children:"kubectl config get-contexts"})," to get all of the contexts it knows about;\nthe one with a star next to it should be named ",(0,t.jsx)(n.code,{children:"<your_AWS_username>@<cluster_name>"}),".\nIf that isn't present, you'll have to edit the configuration to make the appropriate context."]}),"\n",(0,t.jsxs)(n.p,{children:["You next need to add the Agones, ingress-nginx, and redis Helm charts to helm by running\n",(0,t.jsx)(n.code,{children:"helm repo add agones https://agones.dev/chart/stable"}),", ",(0,t.jsx)(n.code,{children:"helm repo add ingress-nginx https://kubernetes.github.io/ingress-nginx"}),", and ",(0,t.jsx)(n.code,{children:"helm repo add redis https://charts.bitnami.com/bitnami"}),".\nYou should also at this time add iR Engine's repo via ",(0,t.jsx)(n.code,{children:"helm repo add etherealengine https://helm.etherealengine.org"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["If you ever suspect that a chart is out-of-date, run ",(0,t.jsx)(n.code,{children:"helm repo update"})," to update all of them to the latest."]}),"\n",(0,t.jsx)(n.h3,{id:"install-agones",children:"Install Agones"}),"\n",(0,t.jsxs)(n.p,{children:["From the top level of this repo, run ",(0,t.jsx)(n.code,{children:"helm install -f </path/to/agones-default-values.yaml> agones agones/agones"}),".\nThis says to install a service called 'agones' from the 'agones' package in the 'agones' chart, and to configure it with\n",(0,t.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/agones-default-values.yaml",children:"agones-default-values.yaml"})," that can be found in ",(0,t.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops",children:"ethereal-engine-ops"})," repo."]}),"\n",(0,t.jsx)(n.h3,{id:"install-redis-for-each-deployment",children:"Install redis for each deployment"}),"\n",(0,t.jsx)(n.p,{children:"Each deployment of iR Engine uses a redis cluster for coordinating the 'feathers-sync' library.\nEach redis deployment needs to be named the same as the deployment that will use it; for an\niR Engine deployment named 'dev', the corresponding redis deployment would need to be named\n'dev-redis'."}),"\n",(0,t.jsxs)(n.p,{children:["Run ",(0,t.jsx)(n.code,{children:"helm install -f </path/to/redis-values.yaml> <RELEASE_NAME>-redis redis/redis"})," to install, e.g.\n",(0,t.jsx)(n.code,{children:"helm install -f </path/to/redis-values.yaml> dev-redis redis/redis"}),"."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/redis-values.yaml",children:"redis-values.yaml"})," can be found in ",(0,t.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops",children:"ethereal-engine-ops"})," repo."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["If you named the redis nodegroup something other than 'ng-redis-1', you'll have to alter the value in\n",(0,t.jsx)(n.code,{children:"redis-values.yaml"})," in two places to your redis nodegroup name.\nIf you didn't create a nodegroup just for redis, you must omit the ",(0,t.jsx)(n.code,{children:"-f </path/to/redis-values.yaml>"}),",\nas that config makes redis pods run on a specific nodegroup."]}),"\n",(0,t.jsx)(n.h4,{id:"installing-redis-as-part-of-ir-engine-chart-not-recommended-for-production",children:"Installing redis as part of iR Engine chart (not recommended for production)"}),"\n",(0,t.jsx)(n.p,{children:"Redis can be installed as part of the iR Engine chart so long as the config file for the iR Engine installation has 'redis.enabled' set to true.\nIn that case, you should skip the above step of installing redis separately. This is not recommended for production\nenvironments, though, since upgrades to an iR Engine installation will usually reboot the redis servers,\nleading all of the instanceservers to crash due to their redis connections being severed."}),"\n",(0,t.jsx)(n.p,{children:"This breaks Agones' normal behavior of keeping Allocated instanceservers running until every user has left and slowly replacing\nold Ready instanceservers with new ones, maintaining an active pool of instanceservers at all times. You will encounter a period\nof time where there are no active instanceservers at all, which is not recommended, and all instanceservers in use\nwill immediately go down."}),"\n",(0,t.jsx)(n.h3,{id:"install-ingress-nginx",children:"Install ingress-nginx"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"This step cannot finish until the associated ACM Certificate is fully validated"}),"\nOpen local version of ",(0,t.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/nginx-ingress-aws-values.yml",children:"nginx-ingress-aws-values.yml"})," file. Take note of the line\n",(0,t.jsx)(n.code,{children:'service.beta.kubernetes.io/aws-load-balancer-ssl-cert: "<ACM Certificate ARN for SSL>"'}),"\nReplace the bit in angle brackets, including the angle brackets, with the ARN of the certificate\nyou made for the top-level domain and all wildcarded subdomains, e.g.\n",(0,t.jsx)(n.code,{children:'service.beta.kubernetes.io/aws-load-balancer-ssl-cert: "arn:aws:acm:us-west-1:103947711118:certificate/aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa"'})]}),"\n",(0,t.jsx)(n.p,{children:"Do not commit this file with the ARN inserted; once you've completed this step, revert the file back\nto the state it was committed in."}),"\n",(0,t.jsxs)(n.p,{children:["From the top level of this repo, run ",(0,t.jsx)(n.code,{children:"helm install -f </path/to/nginx-ingress-aws-values.yml> nginx ingress-nginx/ingress-nginx"}),"\nThis says to install a service called 'nginx' from the 'ingress-nginx' package in the 'ingress-nginx' chart, and to configure it with\na file found at ",(0,t.jsx)(n.a,{href:"https://github.com/EtherealEngine/ethereal-engine-ops/blob/master/configs/nginx-ingress-aws-values.yml",children:"nginx-ingress-aws-values.yml"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>r});var t=s(6540);const i={},a=t.createContext(i);function o(e){const n=t.useContext(a);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),t.createElement(a.Provider,{value:n},e.children)}}}]);